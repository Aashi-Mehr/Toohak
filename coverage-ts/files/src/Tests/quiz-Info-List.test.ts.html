
  <!DOCTYPE html>
  <html>
    <head>
      <title>quiz-Info-List.test.ts</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="../../../assets/source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="../../../assets/source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="../../../index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="positive"><td class="">src/Tests/quiz-Info-List.test.ts</td><td class="">94.72%</td><td class="">80%</td><td class="">284</td><td class="">269</td><td class="">15</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">/*
  Test-Functions for:
   1. adminQuizList
   2. adminQuizInfo

  Author:
  Zhejun Gu (z5351573)

  Edited on:
  20/10/2023
  */

import request from &#x27;sync-request-curl&#x27;;
import { port, url } from &#x27;../config.json&#x27;;

import {
  ErrorObject,
  Token,
  QuizList,
  QuizInfo
} from &#x27;../dataStore&#x27;;

import {
  requestRegister,
  requestQuizCreate,
  requestQuizList,
  requestQuizInfo,
  requestQuizRemove
} from &#x27;./testHelper&#x27;;

const SERVER_URL = `${url}:${port}`;

/// ////////////////////////////////////////////////////////////////////////////
/// //////////////////////////////// Tests /////////////////////////////////////
/// ////////////////////////////////////////////////////////////////////////////

// Clear the dataBase before each test to avoid data interference
beforeEach(() =&gt; {
  const res = request(
    &#x27;DELETE&#x27;,
    SERVER_URL + &#x27;/v1/clear&#x27;,
    {
      qs: { }
    }
  );
  return JSON.parse(res.body.toString());
});

// Test function : adminQuizList
describe(&#x27;adminQuizList&#x27;, () =&gt; {
  let userId: Token;
  let quiz: QuizList | ErrorObject;
  let quizId: number;

  test(&#x27;INVALID User Id: Type of string or negative number&#x27;, () =&gt; {
    quiz = requestQuizList(&#x27;123321&#x27;);
    expect(quiz).toMatchObject({ error: expect.any(String) });

    quiz = requestQuizList(-1);
    expect(quiz).toMatchObject({ error: expect.any(String) });
  });

  test(&#x27;INVALID User Id: Not in the data base&#x27;, () =&gt; {
    userId = requestRegister(&#x27;first.last1@gmail.com&#x27;, &#x27;abcd1234&#x27;, &#x27;first&#x27;,
      &#x27;last&#x27;);
    quiz = requestQuizList(11);
    expect(quiz).toMatchObject({ error: expect.any(String) });
  });

  test(&#x27;VALID 1 Quiz&#x27;, () =&gt; {
    userId = requestRegister(&#x27;1531_user1@gmail.com&#x27;, &#x27;C123321c&#x27;, &#x27;first&#x27;,
      &#x27;last&#x27;);
    quizId = requestQuizCreate(userId.token, &#x27;first last&#x27;, &#x27;&#x27;).quizId;

    quiz = requestQuizList(userId.token);
    expect(quiz).toMatchObject({
      quizzes: [
        {
          quizId: quizId,
          name: &#x27;first last&#x27;,
        }
      ]
    });
  });

  test(&#x27;VALID 2 Quizzes&#x27;, () =&gt; {
    userId = requestRegister(&#x27;1531_user1@gmail.com&#x27;, &#x27;C123321c&#x27;, &#x27;first&#x27;,
      &#x27;last&#x27;);
    const quizId1 = requestQuizCreate(userId.token, &#x27;first last1&#x27;, &#x27;&#x27;);
    const quizId2 = requestQuizCreate(userId.token, &#x27;first last2&#x27;, &#x27;&#x27;);

    quiz = requestQuizList(userId.token);
    expect(quiz).toMatchObject({
      quizzes: [
        {
          quizId: quizId1.quizId,
          name: &#x27;first last1&#x27;,
        },
        {
          quizId: quizId2.quizId,
          name: &#x27;first last2&#x27;,
        }
      ]
    });
  });

  test(&#x27;VALID After Removal&#x27;, () =&gt; {
    userId = requestRegister(&#x27;1531_user1@gmail.com&#x27;, &#x27;C123321c&#x27;, &#x27;first&#x27;,
      &#x27;last&#x27;);
    quizId = requestQuizCreate(userId.token, &#x27;first last1&#x27;, &#x27;&#x27;).quizId;
    requestQuizRemove(userId.token, quizId);

    const result = requestQuizList(userId.token);
    expect(result).toMatchObject({ quizzes: [] });
  });
});

// Test function : adminQuizInfo
describe(&#x27;adminQuizInfo&#x27;, () =&gt; {
  let userId: Token;
  let quiz: QuizInfo | ErrorObject;
  let quizId: number;

  test(&#x27;INVALID User Id: Not a number or out of range number&#x27;, () =&gt; {
    quiz = requestQuizInfo(&#x27;12321&#x27;, 1);
    expect(quiz).toMatchObject({ error: expect.any(String) });

    quiz = requestQuizInfo(-1, 1);
    expect(quiz).toMatchObject({ error: expect.any(String) });
  });

  test(&#x27;INVALID User Id: Invalid quizId or quizId not matching&#x27;, () =&gt; {
    // Register test id: 2 by user id: 1
    quizId = requestQuizCreate(1, &#x27;first last&#x27;, &#x27;fist_test&#x27;).quizId;

    // Quiz ID does not refer to a valid quiz
    quiz = requestQuizInfo(1, -100);
    expect(quiz).toMatchObject({ error: expect.any(String) });

    // Quiz ID does not refer to a quiz that this user owns
    quiz = requestQuizInfo(2, 2);
    expect(quiz).toMatchObject({ error: expect.any(String) });
  });

  test(&#x27;INVALID User Id: UserId does not exist&#x27;, () =&gt; {
    // Register user with id: 1
    userId = requestRegister(&#x27;firstlast@gmail.com&#x27;, &#x27;abcd1234&#x27;, &#x27;firs&#x27;, &#x27;last&#x27;);

    // Correct format UserId but never is the Id being registered
    quiz = requestQuizInfo(4, 1);
    expect(quiz).toMatchObject({ error: expect.any(String) });
  });

  test(&#x27;Test Valid User and Quiz Ids&#x27;, () =&gt; {
    userId = requestRegister(&#x27;user1531@gmail.com&#x27;, &#x27;Password1&#x27;, &#x27;firs&#x27;, &#x27;last&#x27;);
    quizId = requestQuizCreate(userId.token, &#x27;QuizName&#x27;, &#x27;&#x27;).quizId;

    expect(requestQuizInfo(userId.token, quizId)).toMatchObject({
      quizId: quizId,
      name: &#x27;QuizName&#x27;,
      timeCreated: expect.any(Number),
      timeLastEdited: expect.any(Number),
      description: expect.any(String),
      numQuestions: 0,
      questions: [],
      duration: 0
    });
  });

  test(&#x27;Test successful quiz read - correct timestamp format&#x27;, () =&gt; {
    userId = requestRegister(&#x27;user1531@gmail.com&#x27;, &#x27;Password1&#x27;, &#x27;firs&#x27;, &#x27;last&#x27;);
    quizId = requestQuizCreate(userId.token, &#x27;first last&#x27;, &#x27;&#x27;).quizId;

    quiz = requestQuizInfo(userId.token, quizId);
    expect(quiz).toMatchObject({
      quizId: quizId,
      name: &#x27;first last&#x27;,
      timeCreated: expect.any(Number),
      timeLastEdited: expect.any(Number),
      description: expect.any(String),
      numQuestions: 0,
      questions: [],
      duration: 0
    });

    // This will always be true if the above expect-test passes
    if (&#x27;timeCreated&#x27; in quiz &amp;&amp; &#x27;timeLastEdited&#x27; in quiz) {
      expect(quiz.timeCreated.toString()).toMatch(/^\d{10}$/);
      expect(quiz.timeLastEdited.toString()).toMatch(/^\d{10}$/);
    }
  });

  test(&#x27;Test quizId invalid error, cannot read&#x27;, () =&gt; {
    userId = requestRegister(&#x27;user1@gmail.com&#x27;, &#x27;C123321c&#x27;, &#x27;first&#x27;, &#x27;last&#x27;);
    quizId = requestQuizCreate(userId.token, &#x27;first last&#x27;, &#x27;&#x27;).quizId;

    const quiz = requestQuizInfo(userId.token, quizId + 1);
    expect(quiz).toStrictEqual({ error: expect.any(String) });
  });
});
</textarea><pre id="annotations" style="display:none">[{&quot;file&quot;:&quot;src/Tests/quiz-Info-List.test.ts&quot;,&quot;line&quot;:56,&quot;character&quot;:33,&quot;text&quot;:&quot;error&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/Tests/quiz-Info-List.test.ts&quot;,&quot;line&quot;:59,&quot;character&quot;:33,&quot;text&quot;:&quot;error&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/Tests/quiz-Info-List.test.ts&quot;,&quot;line&quot;:66,&quot;character&quot;:33,&quot;text&quot;:&quot;error&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/Tests/quiz-Info-List.test.ts&quot;,&quot;line&quot;:125,&quot;character&quot;:33,&quot;text&quot;:&quot;error&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/Tests/quiz-Info-List.test.ts&quot;,&quot;line&quot;:128,&quot;character&quot;:33,&quot;text&quot;:&quot;error&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/Tests/quiz-Info-List.test.ts&quot;,&quot;line&quot;:137,&quot;character&quot;:33,&quot;text&quot;:&quot;error&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/Tests/quiz-Info-List.test.ts&quot;,&quot;line&quot;:141,&quot;character&quot;:33,&quot;text&quot;:&quot;error&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/Tests/quiz-Info-List.test.ts&quot;,&quot;line&quot;:150,&quot;character&quot;:33,&quot;text&quot;:&quot;error&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/Tests/quiz-Info-List.test.ts&quot;,&quot;line&quot;:160,&quot;character&quot;:6,&quot;text&quot;:&quot;timeCreated&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/Tests/quiz-Info-List.test.ts&quot;,&quot;line&quot;:161,&quot;character&quot;:6,&quot;text&quot;:&quot;timeLastEdited&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/Tests/quiz-Info-List.test.ts&quot;,&quot;line&quot;:162,&quot;character&quot;:6,&quot;text&quot;:&quot;description&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/Tests/quiz-Info-List.test.ts&quot;,&quot;line&quot;:177,&quot;character&quot;:6,&quot;text&quot;:&quot;timeCreated&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/Tests/quiz-Info-List.test.ts&quot;,&quot;line&quot;:178,&quot;character&quot;:6,&quot;text&quot;:&quot;timeLastEdited&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/Tests/quiz-Info-List.test.ts&quot;,&quot;line&quot;:179,&quot;character&quot;:6,&quot;text&quot;:&quot;description&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/Tests/quiz-Info-List.test.ts&quot;,&quot;line&quot;:197,&quot;character&quot;:33,&quot;text&quot;:&quot;error&quot;,&quot;kind&quot;:1}]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Wed, 01 Nov 2023 00:14:18 GMT</p>
    </body>
  </html>
  